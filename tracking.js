window.tracking={"ga4ID":"G-TVL0CFNFP9","searchParam":"NULL","headerSelector":"header","footerSelector":"footer","formThanksSelector":".form-submission-text"};
window.trackingHelp={internalMode:!1,URL:document.location.href,exclusionObject:"xit",regexPIIkey:new RegExp("email|phone|name|postcode|mobile","g"),regexPIIvalue:new RegExp("@|%40","g"),regexFiletype:new RegExp(".(pdf|xlsx?|docx?|txt|rtf|csv|exe|pp(s|t|tx)|7z|png|rar|gz|zip|avi|mov|mp4|mpe?g|wmv|midi?|mp3|wav|wma)","g"),epTiming:3e4,epScroll:.5};const appendScript=e=>{let t=document,n=t.createElement("script");n.src=e,t.head.appendChild(n)},setUpGtag=()=>{null===document.querySelector("script[src*='gtag']")&&(appendScript("https://www.googletagmanager.com/gtag/js?id="+tracking.ga4ID),window.dataLayer=window.dataLayer||[],gtag("js",new Date))};function gtag(){setUpGtag(),dataLayer.push(arguments)}const eventGA4=(e,t)=>{let n=t;n||(n={}),n.send_to=tracking.ga4ID,trackingHelp.internalMode?(console.log("Sending GA event "+e),console.log(n)):gtag("event",e,n)},fireEventError=e=>{eventGA4("exception",{description:e.message,url:e.filename,line:e.lineno})},fireEventPrint=()=>{eventGA4("print")},fireEventSearch=()=>{eventGA4("view_search_results",{search_term:tracking.searchQuery})},fireEventLinkCTA=e=>{let t=e.split(":");t[0],t[1];eventGA4("CTA",{CPCTAs_R:1,CPCTAValue:e})},fireEventLinkDownload=e=>{let t=e.replace(/^.*\./,"");eventGA4("file_download",{file_extension:t,file_name:e})},fireEventLinkOutbound=e=>{let t=e.replace(/^https?\:\/\//,"").replace(/\/.*$/,"");eventGA4("click",{outbound:!0,link_url:e,link_domain:t})},fireEventLead=()=>{eventGA4("generate_lead",{CPLeads_R:1})},listenToEventError=()=>{window.addEventListener("error",fireEventError)},listenToEventPrint=()=>{window.addEventListener("beforeprint",fireEventPrint)},listenToEventSearch=()=>{tracking.isSearch&&eventGA4("view_search_results",{search_term:tracking.searchQuery})},processLinkClick=e=>{let t=e.target;if(!t.matches("a, a *"))return;for(;!t.matches("a");)t=t.parentElement;let n=t.href;n.includes("mailto:")?fireEventLinkCTA(n):n.includes("tel:")?fireEventLinkCTA(n):n.includes(window.location.hostname)?n.match(trackingHelp.regexFiletype)&&fireEventLinkDownload(n):fireEventLinkOutbound(n)},listenToEventLinkClick=()=>{window.addEventListener("click",processLinkClick)},listenToEventCalendly=()=>{window.addEventListener("message",e=>{null!=e.data.event&&e.data.event.includes("calendly")&&fireEventCalendly(e.data.event)})},observeFn=e=>{thanksMsg()&&fireEventLead()},thanksMsg=()=>document.querySelectorAll(tracking.formThanksSelector).length>0,listenToForm=()=>{if(thanksMsg())fireEventLead();else{new MutationObserver(observeFn).observe(document.body,{childList:!0,subtree:!0,characterDataOldValue:!1})}},fireEventEngagedPageview=()=>{eventGA4("EngagedPageview",{CPEngagedPageviews_R:1})},listenToEventEngagedPageview=()=>{setTimeout(function(){trackingHelp.epTimingFlag=!0,trackingHelp.epScrollFlag&&!trackingHelp.epFlag&&(trackingHelp.epFlag=!0,fireEventEngagedPageview())},trackingHelp.epTiming);const e=document.body,t=document.documentElement;let n=Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight);n-=document.querySelector(tracking.headerSelector).offsetHeight,(n-=document.querySelector(tracking.footerSelector).offsetHeight)<window.innerHeight?trackingHelp.epScrollFlag=!0:document.addEventListener("scroll",function(){const e=document.querySelector(tracking.headerSelector).offsetTop,t=window.pageYOffset||document.documentElement.scrollTop;Math.min((t-e)/n,1)>trackingHelp.epScroll&&(trackingHelp.epScrollFlag=!0,trackingHelp.epTimingFlag&&!trackingHelp.epFlag&&(trackingHelp.epFlag=!0,fireEventEngagedPageview()))})},listenToEvents=()=>{window.addEventListener("error",fireEventError),window.addEventListener("beforeprint",fireEventPrint),listenToEventEngagedPageview(),tracking.isSearch&&eventGA4("view_search_results",{search_term:tracking.searchQuery}),window.addEventListener("click",processLinkClick),listenToForm()},pageviewGA=()=>{let e={page_location:trackingHelp.URL,anonymize_ip:!0,send_page_view:!1,allow_google_signals:!1};trackingHelp.internalMode?(console.log("Initialising GA for "+tracking.ga4ID),console.log(e)):gtag("config",tracking.ga4ID,e),eventGA4("page_view",{CPSpeedDomInteractive:tracking.timeDomInteractive,CPSpeedDomReady:tracking.timeDomReady,CPSpeedTotal:tracking.timePageLoad})},fireEventPageview=()=>{pageviewGA()},processParam=e=>{try{let t,n=e.split("="),i=n[0],a=n[1];return i===tracking.searchParam?(tracking.isSearch=!0,tracking.searchQuery=decodeURIComponent(a).replace(/\+/g," "),t=tracking.searchParam+"="+a):t=i.match(trackingHelp.regexPIIkey)||a.match(trackingHelp.regexPIIvalue)?i+"=XXXX":i+"="+a,t}catch(e){return"XXXX"}},processURL=()=>{let e="",t=[],n=window.location.search.replace("?","");if(""!=n){let i=n.split("&");for(let e=0;e<i.length;e++)t.push(processParam(i[e]));e="?"+t.join("&")}trackingHelp.URL="https://"+window.location.hostname+window.location.pathname+e},processUserEngagement=()=>{var e,t=localStorage.getItem("userActivity");null==t?e={sessions:1,pages:1}:((e=JSON.parse(t)).pages++,document.referrer.includes(document.location.hostname)||e.sessions++,e.fired||3!=e.sessions&&3!=e.pages||(e.fired=!0,eventGA4("MultiPageEngagement"))),localStorage.setItem("userActivity",JSON.stringify(e))},processPageTimings=()=>{let e=window.performance.timing,t=e.loadEventEnd-e.navigationStart,n=e.domComplete-e.responseStart,i=e.domInteractive-e.responseStart;tracking.timePageLoad=Math.round(t/100),tracking.timeDomReady=Math.round(n/100),tracking.timeDomInteractive=Math.round(i/100),tracking.timePageLoad>300&&(tracking.timePageLoad=300),tracking.timeDomReady>300&&(tracking.timeDomReady=300),tracking.timeDomInteractive>300&&(tracking.timeDomInteractive=300),tracking.timePageLoad<=0&&(tracking.timePageLoad=void 0),tracking.timeDomReady<=0&&(tracking.timeDomReady=void 0),tracking.timeDomInteractive<=0&&(tracking.timeDomInteractive=void 0)},startTracking=()=>{trackingHelp.URL.includes(trackingHelp.exclusionObject+"=")&&window.localStorage.setItem(trackingHelp.exclusionObject,!0),window.localStorage.getItem(trackingHelp.exclusionObject)&&(trackingHelp.internalMode=!0),processUserEngagement(),processURL(),processPageTimings(),pageviewGA(),window.addEventListener("error",fireEventError),window.addEventListener("beforeprint",fireEventPrint),listenToEventEngagedPageview(),tracking.isSearch&&eventGA4("view_search_results",{search_term:tracking.searchQuery}),window.addEventListener("click",processLinkClick),listenToForm()};startTracking();
